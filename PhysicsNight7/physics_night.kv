#:import RiseInTransition kivy.uix.screenmanager.RiseInTransition
#:import TextInput kivy.uix.textinput.TextInput
#:import GridLayout kivy.uix.gridlayout
#:import C kivy.utils.get_color_from_hex
#:import Config kivy.config.Config
#:import ToggleButton kivy.uix.togglebutton 
#:import Image kivy.uix.image

<UpperBarLabel@Label>:
    font_name: 'Roboto'
    font_size: 22
    markup: True

<LineButton@RadioButton>:
	group: 'all_line'
	background_normal: "gray_dot.png"
	background_down: "blue_dot.png"

<BottumButton@RadioButton>:
	group: 'bottum'


<StoryLabel@Label>:
    halign: 'left'
    valign: 'top'
    color: C('#FFFFFF')
    markup: True
    text_size: (self.width, None) # Step 1
    size_hint: (1, None) # Step 2
    height: self.texture_size[1] # Step 3

<ChineseStoryLabel@Label>:
	font_name: 'STHeiti Medium.ttc'
	halign: 'left'
	valign: 'top'
	color: C('#FFFFFF')
	markup: True
	text_size: (self.width, None) # Step 1
	size_hint: (1, None) # Step 2
	height: self.texture_size[1] # Step 3


<P_coinLabel@Label>:
    color: C('#FFFFFF')
	font_size: 300
 

<ScreenManager>:
    transition: RiseInTransition()
    ############################################################## 'Login' #########################################################
    Screen_Canvas:
    	id: id_login
    	name: 'login'
    	BoxLayout:
			orientation: 'vertical'
			GridLayout:
				cols: 2
				rows: 5
				spacing: 50
				padding: 50 
		
				Label: 
					font_name: 'STHeiti Medium.ttc'
					font_size: 50
					text: 'NickName / 暱稱\n(English only !!!)'
				TextInput:
					font_name: 'STHeiti Medium.ttc'
					font_size: 40
					id: realname
					hint_text: 'ex: Tess'
				Label: 
					font_name: 'STHeiti Medium.ttc'
					font_size: 50
					text: 'Department / 系級\n(English only !!!)'
				TextInput:
					font_name: 'STHeiti Medium.ttc'
					font_size: 40
					id: department
					hint_text: 'ex: Physics 2'	
				Label:
					font_name: 'STHeiti Medium.ttc' 
					font_size: 50
					text: 'Student ID / 學號\n(English only !!!)'
				TextInput:
					font_name: 'STHeiti Medium.ttc'
					font_size: 40
					id: username
					hint_text: 'ex: b04202999'
				Label:
					font_name: 'STHeiti Medium.ttc'
					font_size: 50
					text: 'Password / 密碼\n(English only !!!)'
				TextInput:
					font_name: 'STHeiti Medium.ttc'
					font_size: 40
					id: password
					hint_text: 'ex: tesstesstess3737pospos'

				Label:
					font_name: 'STHeiti Medium.ttc'
					font_size: 50
					text: 'Password check / 確認密碼\n 	(English only !!!)'
				TextInput:
					font_name: 'STHeiti Medium.ttc'
					font_size: 40
					id: passwordcheck
					hint_text: 'ex: tesstesstess3737pospos'


			BoxLayout:
				height: 0.25 * root.height
				width: root.width
				size_hint: (None, None)
				Button:
					font_size: 100
					background_normal: 'create.png'
					background_color: C('#FFFFFF')
					on_press:
						app.create() 

				Button:
					font_size: 100
					background_normal: 'start.png'
					background_color: C('#FFFFFF')
					on_press:
						app.start_game() 

    ############################################################## 'Home' #########################################################
	Screen_Canvas:
		id: id_home 
		name: 'Home' 
    	Image:
    		id: home_background
    		allow_stretch: True    
    		keep_ratio: False
    		size: (self.parent.width, self.parent.height)
    		size_hint: (None, None)
    		size_hint_x: None
    		size_hint_y: None
    		source: 'pline_background.png'   

		Button:
			id: switch_to_y
			text: 'Y-line Story'
			background_color: C('#0000FF')
			size: (0.2 * root.width, 0.10 * root.height)
			size_hint: (None, None)
			x: 0.8 * root.width
			y: 0.2 * root.height
			on_press:
				app.switch('y')

		BoxLayout:
			x: 0.38 * root.width 
			y: 0.445 * root.height
			UpperBarLabel:
				id: time
				color: 0, 0, 0
				text: '00:00:00'
		BoxLayout:
			x: -0.30 * root.width 
			y: 0.445 * root.height
			UpperBarLabel:
				id: money
				color: 0, 0, 0
				text: '0000'

		Image:
			size: (0.17 * root.width, 0.08 * root.height)
			size_hint: (None, None)
			color: C('#FFFFFF')
			pos: (0.0 * root.width, 0.83 * root.height)
			opacity: 0.8

		BoxLayout:
			x: 0.0 * root.width
			y: 0.83 * root.height
			size: (0.17 * root.width, 0.08 * root.height)
			size_hint: (None, None)
			opacity: 1
			Label:
				pos: (0.02 * root.width, 0.85 * root.height)
				font_size: 25
				font_name: 'STHeiti Medium.ttc'
				id: username_label
				color: C('#000000')
				text: '您好!!\n'

		BottumButton:
			id: bottum_1
			x: 0.15 * root.width
			y: 0
			size: [0.15 * root.width, 0.12 * root.width]
			size_hint: (None, None)
			background_normal: "story.png"
			background_down: "story_shadow.png"
			state: 'down'
			on_press:
				app.change_state(1)
		BottumButton:
			id: bottum_2
			x: 0.46 * root.width
			y: 0
			size: [0.15 * root.width, 0.12 * root.width]
			size_hint: (None, None)
			background_normal: "treasure_black.png"
			background_down: "treasure_color.png"
			on_press:
				app.treasure()
		BottumButton:
			id: bottum_3
			x: 0.75 * root.width
			y: 0
			size: [0.15 * root.width, 0.12 * root.width]
			size_hint: (None, None)
			background_normal: "Pcoin.png"
			background_down: "Pcoin_shadow.png"
			on_press: 
				#root.ids.canvas_state.source:"timer.png"
				app.change_state(2)
		LineButton:
			id: all_line_01 
			size: (0.1 * root.width, 0.08 * root.height)
			size_hint: (None, None)
			x: 0.24 * root.width
			y: 0.185 * root.height
			state: 'down'
			on_release:
				app.change_dot(1)
		LineButton:
			id: all_line_02
			size: (0.1 * root.width, 0.08 * root.height)
			size_hint: (None, None)
			x: 0.05 * root.width
			y: 0.42 * root.height
			on_release:
				app.change_dot(2)
		LineButton:
			id: all_line_03
			size: (0.1 * root.width, 0.08 * root.height)
			size_hint: (None, None)
			x: 0.23 * root.width
			y: 0.58 * root.height
			on_release:
				app.change_dot(3)
		LineButton:
			id: all_line_04
			size: (0.1 * root.width, 0.08 * root.height)
			size_hint: (None, None)
			x: 0.18 * root.width
			y: 0.745 * root.height
			on_release:
				app.change_dot(4)
		LineButton:
			id: all_line_05
			size: (0.1 * root.width, 0.08 * root.height)
			size_hint: (None, None)
			x: 0.45 * root.width
			y: 0.80 * root.height
			on_release:
				app.change_dot(5)
		LineButton:
			id: all_line_06
			size: (0.1 * root.width, 0.08 * root.height)
			size_hint: (None, None)
			x: 0.55 * root.width
			y: 0.68 * root.height
			on_release:
				app.change_dot(6)
		LineButton:
			id: all_line_07
			size: (0.1 * root.width, 0.08 * root.height)
			size_hint: (None, None)
			x: 0.75 * root.width
			y: 0.80 * root.height
			on_release:
				app.change_dot(7)
		LineButton:
			id: all_line_08
			size: (0.1 * root.width, 0.08 * root.height)
			size_hint: (None, None)
			x: 0.86 * root.width
			y: 0.62 * root.height
			on_release:
				app.change_dot(8)
		LineButton:
			id: all_line_09
			size: (0.1 * root.width, 0.08 * root.height)
			size_hint: (None, None)
			x: 0.68 * root.width
			y: 0.54 * root.height
			on_release:
				app.change_dot(9)
		LineButton:
			id: all_line_10
			size: (0.1 * root.width, 0.08 * root.height)
			size_hint: (None, None)
			x: 0.75 * root.width
			y: 0.45 * root.height
			on_release:
				app.change_dot(10)
		LineButton:
			id: all_line_11
			size: (0.1 * root.width, 0.08 * root.height)
			size_hint: (None, None)
			x: 0.37 * root.width
			y: 0.47 * root.height
			on_release:
				app.change_dot(11)
		LineButton:
			id: all_line_12
			size: (0.1 * root.width, 0.08 * root.height)
			size_hint: (None, None)
			x: 0.32 * root.width
			y: 0.35 * root.height
			on_release:
				app.change_dot(12)

		Button:
			id: logout
			text: 'Log Out'
			background_color: C('#FF0000')
			size: (0.2 * root.width, 0.10 * root.height)
			size_hint: (None, None)
			x: 0.8 * root.width
			y: 0.3 * root.height
			on_press:
				app.logout()
    ############################################################## 'YLine' #########################################################
	Screen_Canvas:
		id: id_yline 
		name: 'YLine' 
    	Image:
    		id: yline_background
    		allow_stretch: True    
    		keep_ratio: False
    		size: (self.parent.width, self.parent.height)
    		size_hint: (None, None)
    		size_hint_x: None
    		size_hint_y: None
    		source: 'yline_background.png'   

		Button:
			id: switch_to_p
			text: 'P-line Story'
			background_color: C('#0000FF')
			size: (0.2 * root.width, 0.10 * root.height)
			size_hint: (None, None)
			x: 0.0 * root.width
			y: 0.2 * root.height
			on_press:
				app.switch('p')

		Button:
			id: switch_to_h
			text: 'H-line Story'
			background_color: C('#0000FF')
			size: (0.2 * root.width, 0.10 * root.height)
			size_hint: (None, None)
			x: 0.8 * root.width
			y: 0.4 * root.height
			on_press:
				app.switch('h')


		BoxLayout:
			x: 0.38 * root.width 
			y: 0.445 * root.height
			UpperBarLabel:
				id: time_y
				color: 0, 0, 0
				text: '00:00:00'
		BoxLayout:
			x: -0.30 * root.width 
			y: 0.445 * root.height
			UpperBarLabel:
				id: money_y
				color: 0, 0, 0
				text: '0000'

		Image:
			size: (0.17 * root.width, 0.08 * root.height)
			size_hint: (None, None)
			color: C('#FFFFFF')
			pos: (0.0 * root.width, 0.83 * root.height)
			opacity: 0.8

		BoxLayout:
			x: 0.0 * root.width
			y: 0.83 * root.height
			size: (0.17 * root.width, 0.08 * root.height)
			size_hint: (None, None)
			opacity: 1
			Label:
				pos: (0.02 * root.width, 0.85 * root.height)
				font_size: 25
				font_name: 'STHeiti Medium.ttc'
				id: username_label_y
				color: C('#000000')
				text: '您好!!\n'

		BottumButton:
			id: bottum_1
			x: 0.15 * root.width
			y: 0
			size: [0.15 * root.width, 0.12 * root.width]
			size_hint: (None, None)
			background_normal: "story.png"
			background_down: "story_shadow.png"
			state: 'down'
			on_press:
				app.change_state(1)
		BottumButton:
			id: bottum_2
			x: 0.46 * root.width
			y: 0
			size: [0.15 * root.width, 0.12 * root.width]
			size_hint: (None, None)
			background_normal: "treasure_black.png"
			background_down: "treasure_color.png"
			on_press:
				root.current = 'Home'
				app.treasure()
		BottumButton:
			id: bottum_3
			x: 0.75 * root.width
			y: 0
			size: [0.15 * root.width, 0.12 * root.width]
			size_hint: (None, None)
			background_normal: "Pcoin.png"
			background_down: "Pcoin_shadow.png"
			on_press: 
				root.current = 'Home'
				app.change_state(2)
		LineButton:
			id: all_line_13 
			size: (0.1 * root.width, 0.08 * root.height)
			size_hint: (None, None)
			x: 0.55 * root.width
			y: 0.13 * root.height
			state: 'down'
			on_release:
				app.change_dot(13)
		LineButton:
			id: all_line_14
			size: (0.1 * root.width, 0.08 * root.height)
			size_hint: (None, None)
			x: 0.77 * root.width
			y: 0.10 * root.height
			on_release:
				app.change_dot(14)
		LineButton:
			id: all_line_15
			size: (0.1 * root.width, 0.08 * root.height)
			size_hint: (None, None)
			x: 0.82 * root.width
			y: 0.26 * root.height
			on_release:
				app.change_dot(15)
		LineButton:
			id: all_line_16
			size: (0.1 * root.width, 0.08 * root.height)
			size_hint: (None, None)
			x: 0.68 * root.width
			y: 0.35 * root.height
			on_release:
				app.change_dot(16)
		LineButton:
			id: all_line_17
			size: (0.1 * root.width, 0.08 * root.height)
			size_hint: (None, None)
			x: 0.71 * root.width
			y: 0.49 * root.height
			on_release:
				app.change_dot(17)
		LineButton:
			id: all_line_18
			size: (0.1 * root.width, 0.08 * root.height)
			size_hint: (None, None)
			x: 0.830 * root.width
			y: 0.59 * root.height
			on_release:
				app.change_dot(18)
		LineButton:
			id: all_line_19
			size: (0.1 * root.width, 0.08 * root.height)
			size_hint: (None, None)
			x: 0.70 * root.width
			y: 0.77 * root.height
			on_release:
				app.change_dot(19)
		LineButton:
			id: all_line_20
			size: (0.1 * root.width, 0.08 * root.height)
			size_hint: (None, None)
			x: 0.68 * root.width
			y: 0.60 * root.height
			on_release:
				app.change_dot(20)
		LineButton:
			id: all_line_21
			size: (0.1 * root.width, 0.08 * root.height)
			size_hint: (None, None)
			x: 0.51 * root.width
			y: 0.48 * root.height
			on_release:
				app.change_dot(21)
		LineButton:
			id: all_line_22
			size: (0.1 * root.width, 0.08 * root.height)
			size_hint: (None, None)
			x: 0.26 * root.width
			y: 0.52 * root.height
			on_release:
				app.change_dot(22)
		LineButton:
			id: all_line_23
			size: (0.1 * root.width, 0.08 * root.height)
			size_hint: (None, None)
			x: 0.14 * root.width
			y: 0.69 * root.height
			on_release:
				app.change_dot(23)
		LineButton:
			id: all_line_24
			size: (0.1 * root.width, 0.08 * root.height)
			size_hint: (None, None)
			x: 0.38 * root.width
			y: 0.77 * root.height
			on_release:
				app.change_dot(24)

		Button:
			id: logout
			text: 'Log Out'
			background_color: C('#FF0000')
			size: (0.2 * root.width, 0.10 * root.height)
			size_hint: (None, None)
			x: 0.0 * root.width
			y: 0.3 * root.height
			on_press:
				app.logout()


    ############################################################## 'HLine' #########################################################
	Screen_Canvas:
		id: id_hline 
		name: 'HLine' 
    	Image:
    		id: hline_background
    		allow_stretch: True    
    		keep_ratio: False
    		size: (self.parent.width, self.parent.height)
    		size_hint: (None, None)
    		size_hint_x: None
    		size_hint_y: None
    		source: 'hline_background.png'   

		Button:
			id: switch_to_y
			text: 'Y-line Story'
			background_color: C('#0000FF')
			size: (0.2 * root.width, 0.10 * root.height)
			size_hint: (None, None)
			x: 0.0 * root.width
			y: 0.6 * root.height
			on_press:
				app.switch('y')

		BoxLayout:
			x: 0.38 * root.width 
			y: 0.445 * root.height
			UpperBarLabel:
				id: time_h
				color: 0, 0, 0
				text: '00:00:00'
		BoxLayout:
			x: -0.30 * root.width 
			y: 0.445 * root.height
			UpperBarLabel:
				id: money_h
				color: 0, 0, 0
				text: '0000'

		Image:
			size: (0.17 * root.width, 0.08 * root.height)
			size_hint: (None, None)
			color: C('#FFFFFF')
			pos: (0.0 * root.width, 0.83 * root.height)
			opacity: 0.8

		BoxLayout:
			x: 0.0 * root.width
			y: 0.83 * root.height
			size: (0.17 * root.width, 0.08 * root.height)
			size_hint: (None, None)
			opacity: 1
			Label:
				pos: (0.02 * root.width, 0.85 * root.height)
				font_size: 25
				font_name: 'STHeiti Medium.ttc'
				id: username_label_h
				color: C('#000000')
				text: '您好!!\n'

		BottumButton:
			id: bottum_1
			x: 0.15 * root.width
			y: 0
			size: [0.15 * root.width, 0.12 * root.width]
			size_hint: (None, None)
			background_normal: "story.png"
			background_down: "story_shadow.png"
			state: 'down'
			on_press:
				app.change_state(1)
		BottumButton:
			id: bottum_2
			x: 0.46 * root.width
			y: 0
			size: [0.15 * root.width, 0.12 * root.width]
			size_hint: (None, None)
			background_normal: "treasure_black.png"
			background_down: "treasure_color.png"
			on_press:
				root.current = 'Home'
				app.treasure()
		BottumButton:
			id: bottum_3
			x: 0.75 * root.width
			y: 0
			size: [0.15 * root.width, 0.12 * root.width]
			size_hint: (None, None)
			background_normal: "Pcoin.png"
			background_down: "Pcoin_shadow.png"
			on_press: 
				root.current = 'Home'
				app.change_state(2)
		LineButton:
			id: all_line_25 
			size: (0.1 * root.width, 0.08 * root.height)
			size_hint: (None, None)
			x: 0.07 * root.width
			y: 0.19 * root.height
			state: 'down'
			on_release:
				app.change_dot(25)
		LineButton:
			id: all_line_26
			size: (0.1 * root.width, 0.08 * root.height)
			size_hint: (None, None)
			x: 0.09 * root.width
			y: 0.42 * root.height
			on_release:
				app.change_dot(26)
		LineButton:
			id: all_line_27
			size: (0.1 * root.width, 0.08 * root.height)
			size_hint: (None, None)
			x: 0.27 * root.width
			y: 0.55 * root.height
			on_release:
				app.change_dot(27)
		LineButton:
			id: all_line_28
			size: (0.1 * root.width, 0.08 * root.height)
			size_hint: (None, None)
			x: 0.18 * root.width
			y: 0.72 * root.height
			on_release:
				app.change_dot(28)
		LineButton:
			id: all_line_29
			size: (0.1 * root.width, 0.08 * root.height)
			size_hint: (None, None)
			x: 0.27 * root.width
			y: 0.81 * root.height
			on_release:
				app.change_dot(29)
		LineButton:
			id: all_line_30
			size: (0.1 * root.width, 0.08 * root.height)
			size_hint: (None, None)
			x: 0.44 * root.width
			y: 0.58 * root.height
			on_release:
				app.change_dot(30)
		LineButton:
			id: all_line_31
			size: (0.1 * root.width, 0.08 * root.height)
			size_hint: (None, None)
			x: 0.24 * root.width
			y: 0.35 * root.height
			on_release:
				app.change_dot(31)
		LineButton:
			id: all_line_32
			size: (0.1 * root.width, 0.08 * root.height)
			size_hint: (None, None)
			x: 0.50 * root.width
			y: 0.42 * root.height
			on_release:
				app.change_dot(32)
		LineButton:
			id: all_line_33
			size: (0.1 * root.width, 0.08 * root.height)
			size_hint: (None, None)
			x: 0.70 * root.width
			y: 0.37 * root.height
			on_release:
				app.change_dot(33)
		LineButton:
			id: all_line_34
			size: (0.1 * root.width, 0.08 * root.height)
			size_hint: (None, None)
			x: 0.83 * root.width
			y: 0.25 * root.height
			on_release:
				app.change_dot(34)
		LineButton:
			id: all_line_35
			size: (0.1 * root.width, 0.08 * root.height)
			size_hint: (None, None)
			x: 0.67 * root.width
			y: 0.13 * root.height
			on_release:
				app.change_dot(35)

		Button:
			id: logout
			text: 'Log Out'
			background_color: C('#FF0000')
			size: (0.2 * root.width, 0.10 * root.height)
			size_hint: (None, None)
			x: 0.0 * root.width
			y: 0.5 * root.height
			on_press:
				app.logout()

    ############################################################## 'Story_page' #########################################################
	Screen_Canvas:
		name: 'Story_page'
		BoxLayout:
			ScrollView:
			    canvas.before:
        			Color:
            			rgb: 0, 0, 0
        			Rectangle:
            			pos: self.pos
            			size: self.size
				ChineseStoryLabel:
					id: StoryWindow
					font_size: 50
					text: ''
		Button:
			size: (.3 * root.width, .06 * root.height)
			size_hint: (None, None)
			background_normal: 'back.png'
			background_down: 'back.png'
			x: root.width - self.size[0]
			y: root.height - self.size[1]
			on_press: app.remove_busy(1)
	    ######################################################## 'P-coin_exchange' ######################################################
	Screen_Canvas:
		id: id_p_coin_exchange 
		name: 'P_coin_exchange'
		BoxLayout:
			orientation: 'vertical'
			Label:
            	text: "Shopping Mall"
            	font_size: 80
            	height: .1 * root.height
            	size_hint: (1, None)

			
			ScrollView:
			    canvas.before:
        			Color:
            			rgb: 0.4, 0.4, 0.4
        			Rectangle:
            			pos: self.pos
            			size: self.size

				GridLayout:
					id: id_shopgrid
					size_hint_y: None
					cols: 2
					spacing: 0.03 * root.height
					padding: 0.1 * root.width
					height: self.minimum_height
					row_default_height: 500
					row_default_width: 0.5 * self.width
					row_force_default: True
		Button:
			size: (.3 * root.width, .06 * root.height)
			size_hint: (None, None)
			background_normal: 'back.png'
			background_down: 'back.png'
			x: root.width - self.size[0]
			y: root.height - self.size[1]
			on_press:
				app.change_state(1)

		Button:
			size: (.3 * root.width, .06 * root.height)
			size_hint: (None, None)
			text: 'Your\nBackpack'
			background_color: C('#FF0000')
			opacity: 0.8
			x: 0
			y: root.height - self.size[1]
			on_press: 
				app.processions('in')
    ##########################################################'Your_Processions'########################################################
	Screen_Canvas:
		id: id_your_processions
		name: 'Your_Processions'
		BoxLayout:
			orientation: 'vertical'
			Label:
            	text: "Your BackPack"
            	font_size: 80
            	height: .1 * root.height
            	size_hint: (1, None)

			ScrollView:
			    canvas.before:
        			Color:
            			rgb: 0, 0, 0
        			Rectangle:
            			pos: self.pos
            			size: self.size

				GridLayout:
					id: id_processionsgrid
					size_hint_y: None
					cols: 2
					spacing: 0.03 * root.height
					padding: 0.1 * root.width
					height: self.minimum_height
					row_default_height: 500
					row_default_width: 0.5 * self.width
					row_force_default: True

		Button:
			size: (.3 * root.width, .06 * root.height)
			size_hint: (None, None)
			background_normal: 'back.png'
			background_down: 'back.png'
			x: root.width - self.size[0]
			y: root.height - self.size[1]
			on_press:
				app.processions('out') 

